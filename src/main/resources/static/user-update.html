<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
<link rel="shortcut icon"
	href="https://cdn-icons-png.flaticon.com/512/7656/7656409.png">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<title>User Update Form</title>
<style>
@import
	url('https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@1,800&display=swap')
	;

.navbar-brand {
	margin-left: 1rem;
	color: white !important;
	font-weight: 700;
	font-size: x-large !important;
}

.container-fluid-nav {
	width: 100%;
}

body {
	font-weight: 600 !important;
	overflow-x: hidden;
	font-family: 'Noto Serif', serif;
	margin: 0;
	padding: 0;
}

.main {
margin-top:0px;
	background-color: #fff;
	border-radius: 15px;
	box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
	padding:20px;
	width: 400px;
}

.main h3 {
	color: #198754;
	margin-bottom: 20px;
	text-align:center;
}

label {
	display: block;
	margin-bottom: 5px;
	color: #555;
	font-weight: bold;
	font-size:18px;
}

input[type="text"], input[type="number"], input[type="email"], input[type="password"] {
	height: 23px;
	margin-bottom: 15px;
	padding: 14px;
	box-sizing: border-box;
	border: 1px solid #ddd;
	border-radius: 7px;
	width: 100%;
}

button {
	height: 35px;
	padding: 6px 0px;
	border-radius: 7px;
	border: none;
	background-color: #198754;
	color: white;
	cursor: pointer;
	font-size: 16px;
	width:120px;
}

button:hover {
	background-color: #45a049;
}
footer {
	position: fixed;
	bottom: 0px;
	width: 100%;
	height: 60px;
	font-size: 12px;
	background-color: #313131;
}
.fetch-user {
	margin-top:70px;
	display: flex;
	justify-content: center;
	/*align-items: center;*/
	height: 90vh;
	margin-bottom:70px;
}


.fetching {
text-align:center;
	padding: 10px 5px;
	margin: 20px 5px;
	margin-right:100px;
}

.fetching label {
display:inline;
	margin-left: 120px;
	font-size: 23px;
	color: #198754;
}

.fetching input {
	height: 33px;
	width: 200px;
	padding: 10px;
	box-sizing: border-box;
	border: 1px solid #ddd;
	margin:0px 9px;
}

.fetching button {
padding:5px;
height: 33px;
	width: 180px;
	
}

</style>
<script>
	function showAlert(message, type = 'danger') {
	    const alertContainer = document.getElementById('alertContainer');
	    const alert = document.createElement('div');
	    alert.className = `alert alert-${type} alert-dismissible fade show mt-3`;
	    alert.role = 'alert';
	    alert.innerHTML = `
	        ${message}
	        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	    `;
	    alertContainer.appendChild(alert);
	
	    // Automatically remove the alert after 5 seconds
	    setTimeout(() => {
	        if (alert) alert.remove();
	    }, 5000);
	}
	// Fetch user details by ID
	async function fetchUserById() {
		const userId = document.getElementById('userId').value;
		if (!userId) {
			showAlert('Please enter a valid user ID.');
			return;
		}

		try {
			const response = await fetch(`http://localhost:8888/spring-boot-service/api/user/${userId}`,
					{
						method : 'GET',
						headers : {
							'Accept' : '*/*'
						}
					});

			if (!response.ok) {
				throw new Error('User not found: ' + response.statusText);
			}

			const user = await response.json();

			// Populate form with user data
			document.getElementById('firstname').value = user.firstname;
			document.getElementById('lastname').value = user.lastname;
			document.getElementById('email').value = user.email;
			document.getElementById('password').value = user.password;
			document.getElementById('mobile').value = user.mobile;
			document.getElementById('state').value = user.state;
			document.getElementById('pincode').value=user.pincode;

			showAlert('User details fetched successfully!','success');
		} catch (error) {
			console.error('Error:', error);
			showAlert('Error fetching user details: ' + error.message);
		}
	}

	// Update user details
	 async function updateUserDetails() {
		const userId = document.getElementById('userId').value;
		const updatedUser = {
			id : userId,
			firstname : document.getElementById('firstname').value,
			lastname : document.getElementById('lastname').value,
			email : document.getElementById('email').value,
			password : document.getElementById('password').value,
			mobile : document.getElementById('mobile').value,
			state : document.getElementById('state').value,
			pincode : document.getElementById('pincode').value
		};

		try {
			const response = await fetch(`http://localhost:8888/spring-boot-service/api/user/${userId}`,
					{
						method : 'PUT',
						headers : {
							'Content-Type' : 'application/json',
							'Accept' : '*/*'
						},
						body : JSON.stringify(updatedUser)
					});
			console.log("Response Status:", response.status);
			if (!response.ok) {
				throw new Error('Failed to update user: ' + response.statusText);
			}
			showAlert('User updated successfully!','success');
			// Clear the form fields after a successful update
			clearFormFields();
		} catch (error) {
			console.error('Error:', error);
			showAlert('Error updating user: ' + error.message);
		}
	}

	function clearFormFields() {
		document.getElementById('userId').value = '';
		document.getElementById('firstname').value = '';
		document.getElementById('lastname').value = '';
		document.getElementById('email').value = '';
		document.getElementById('password').value = '';
		document.getElementById('mobile').value = '';
		document.getElementById('state').value = '';
		document.getElementById('pincode').value = '';
	}

	// Clear form on page load
	window.onload = clearFormFields;
</script>
</head>
<body class="bg-light">
	<nav class="navbar sticky-top navbar-expand-md navbar-light bg-success">
		<div class="container-fluid-nav">
			<a class="navbar-brand" href="inventory.html"><i class="fa fa-align-center"
				aria-hidden="true"></i>&nbsp; Inventory</a>
		</div>
	</nav>
	
	<div class="fetching">
		<label for="userId">Enter User ID :</label> 
		<input type="number" id="userId" placeholder="User ID" required>
		<button onclick="fetchUserById()">Get User Details</button>
	</div>
	
	<div class="fetch-user">
		<div class="main">			
			<h3>Update User</h3>
			<form>
				<label for="firstname">First Name : </label>
				<input type="text" id="firstname" name="firstname" required pattern="[A-Za-z\s]+" title="Name should only contain alphabets and spaces."><br>
				
				<label for="lastname">Last Name : </label>
				<input type="text" id="lastname" name="lastname" required pattern="[A-Za-z\s]+" title="Name should only contain alphabets and spaces."><br>
				
				<label for="email">Email : </label> 
				<input type="email" id="email" name="email" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Please enter a valid email address."><br>
				
				<label for="password">Password : </label> 
				<input type="password" id="password" name="password" required pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}" title="Password must be at least 8 characters long, include uppercase, lowercase, a number, and a special character."><br>
				
				<label for="mobile">Mobile Number : </label>
				<input type="text" id="mobile" name="mobile" required pattern="^(\+91)?[6-9]\d{9}$" title="Please enter a valid 10-digit mobile number."><br>
				 
				<label for="state">State : </label> 
				<input type="text" id="state" name="state" pattern="[A-Za-z\s]+" title="Name should only contain alphabets and spaces."><br> 
				
				<label for="pincode">Pincode : </label>
				<input type="number" id="pincode" name="pincode" required minlength="6" maxlength="6" title="Pincode must be exactly 6 digits."><br>
						
				<button type="button" onclick="updateUserDetails()">Update User</button>
			</form>
		</div>
	</div>
	
	<br>
	<!-- Alerts Container -->
    <div id="alertContainer" class="container"></div>
    
	<!-- Footer -->
	<footer class=" text-white text-center py-2">
		<p class="mb-1">Contact Us: <a href="mailto:inventory@support.com" class="text-white">inventory@support.com</a> | +91
			9705357424</p>
		<p class="mb-0">&copy; 2024 Inventory Management</p>
	</footer>
	
	<!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
